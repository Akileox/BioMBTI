rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // 유효한 Bio-MBTI 타입 코드 검증 함수
    function isValidTypeCode(typeCode) {
      return typeCode.matches('^(ICLR|ICLG|ICHR|ICHG|IACR|IACG|IAHR|IAHG|ECLR|ECLG|ECHR|ECHG|EACR|EACG|EAHR|EAHG)$');
    }
    
    // results 컬렉션 규칙
    match /results/{resultId} {
      // 읽기: 모든 사용자 허용 (통계 조회용)
      allow read: if true;
      
      // 쓰기: 서버(Admin SDK)에서만 허용
      // 클라이언트에서 직접 쓰기는 차단 (보안)
      // Admin SDK는 규칙을 우회하므로 서버에서 저장하는 필드들은 모두 허용
      allow create: if false; // 클라이언트 직접 쓰기 차단
      
      // 업데이트 및 삭제는 허용하지 않음 (데이터 무결성 보장)
      allow update, delete: if false;
    }
  }
}

